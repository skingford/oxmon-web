## Context

当前项目中的页面与模块存在较多演示型实现，页面职责与接口契约未形成稳定映射，导致功能迭代时需要同时调整路由、组件与数据处理逻辑。该变更覆盖 dashboard、metrics、domains、agents、alerts、settings 等核心页面，属于跨模块架构调整。

业务前提是：现有目标页面尚未上线使用，不需要保留 UI 或交互层面的向后兼容。这使得“增量改造”并非最优，直接删除旧页面并按接口能力重建可降低过渡复杂度。

约束条件：
- 继续基于 Next.js App Router 与现有 i18n 路由结构（`src/app/[locale]`）
- 复用 `src/components/ui` 作为基础 UI 原子层
- 不引入新的外部状态管理依赖，优先使用现有 React/Next.js 能力

## Goals / Non-Goals

**Goals:**
- 建立“接口契约驱动页面能力”的统一实现路径，页面模块围绕真实 API 能力编排。
- 采用“整页删除 + 重建”的方式替换旧演示型页面模块，减少迁移分支逻辑。
- 定义清晰分层：路由容器层、业务特性层、基础 UI 层，并约束模块输入输出类型。
- 统一异步状态体验（loading/error/empty/success）与错误恢复机制。
- 为后续 tasks 提供可执行的拆分顺序和回滚边界。

**Non-Goals:**
- 不在本次设计中引入全新视觉设计系统或全面改版品牌风格。
- 不修改后端接口协议本身，仅围绕既有或已确认接口契约实现前端重构。
- 不兼容旧页面文件结构与临时演示数据模型。

## Decisions

### 1) 采用“整页删除后重建”而非增量迁移
- 决策：直接移除未上线的旧页面/旧模块实现，按新分层结构重建。
- 理由：避免双轨维护（旧逻辑 + 新逻辑），减少分支判断与回归面。
- 替代方案：增量迁移（保留旧页面逐步替换）。
- 未采用原因：在“未上线”前提下收益低于复杂度，且会拉长重构周期。

### 2) 路由容器与业务模块解耦
- 决策：`src/app/[locale]/...` 页面文件仅负责参数解析、权限/上下文注入与模块装配；业务逻辑下沉到 `src/components/features`。
- 理由：保持路由层薄、便于测试与复用，降低页面文件膨胀。
- 替代方案：页面文件集中承载数据请求与视图逻辑。
- 未采用原因：耦合度高，后续扩展和复用困难。

### 3) 建立接口 DTO 到 ViewModel 的显式转换层
- 决策：在模块边界定义类型（`src/lib/types.ts` 及相关域类型），将 API 返回 DTO 显式转换为页面 ViewModel。
- 理由：隔离后端字段波动，避免 UI 直接耦合 API 原始结构。
- 替代方案：UI 直接消费 API 响应。
- 未采用原因：将导致页面分散处理空值/兜底/格式化，维护成本高。

### 4) 统一异步状态与错误恢复协议
- 决策：所有重构页面必须实现一致的状态切面与恢复动作（重试、刷新、返回上一层或默认态）。
- 理由：提升一致性，降低用户理解成本，并便于 QA 形成通用用例。
- 替代方案：每个模块自定义状态与错误提示。
- 未采用原因：体验割裂，复用率低。

### 5) 迁移按“能力域”分批提交
- 决策：按 domains/agents/metrics/alerts/settings 等能力域切分任务，每批包含“删除旧文件 + 新模块接线 + 基础验证”。
- 理由：控制变更范围，降低一次性重构风险。
- 替代方案：一次性全量替换。
- 未采用原因：回归与问题定位成本过高。

## Risks / Trade-offs

- [Risk] 删除旧页面后若接口契约存在遗漏，可能导致关键路径不可用 → Mitigation：每个能力域先补齐接口字段清单与最小可用场景清单，再实施替换。
- [Risk] 分层后短期内文件数增加，团队需要适应新结构 → Mitigation：在 tasks 中固化目录规范与命名约定，并提供示例模块模板。
- [Risk] 统一异步状态可能限制局部页面的个性化交互 → Mitigation：定义必选基线（状态与恢复）+ 可扩展区（业务定制展示）。
- [Risk] 全量替换缺少“旧版回退页” → Mitigation：以 Git 提交粒度作为回滚单位，按能力域独立合并与回退。

## Migration Plan

1. 冻结旧页面改动入口，确认本次涉及页面清单与接口契约版本。
2. 按能力域创建新页面骨架（路由容器 + feature 模块 + 类型定义）。
3. 每个能力域执行“旧页面删除 -> 新模块接入 -> 基础联调验证”。
4. 完成域级验收后再进入下一域，避免并行大面积冲突。
5. 全域完成后执行统一 smoke-check 与构建验证。

回滚策略：
- 以能力域为单位回滚对应提交，恢复到删除前状态。
- 若发现跨域问题，优先回滚最近合并域，保持主干可运行。

## Open Questions

- 当前后端接口是否已经完成最终字段冻结？如未冻结，需要先定义字段变更窗口。
- 各能力域是否有明确优先级（例如先 domains/agents，再 metrics/alerts）？
- 是否需要在重构阶段保留最小化埋点，以便后续上线后追踪关键交互？
